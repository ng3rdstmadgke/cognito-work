<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top - Auth API & Hosted UI</title>
</head>
<body>
  <div style="margin-bottom: 50px">
    <button id="login_btn" >ログイン</button>
  </div>
<script>
  document.getElementById("login_btn").addEventListener("click", function() {
    let state = "abcdefghij1234567890"
    let nonce = "0987654321zyxwvutsrqponml"
    localStorage.setItem("state", state)
    localStorage.setItem("nonce", nonce)
  
    // 認可エンドポイント
    // https://docs.aws.amazon.com/ja_jp/cognito/latest/developerguide/authorization-endpoint.html
    let url = "https://wng8bngabmwb.auth.ap-northeast-1.amazoncognito.com/oauth2/authorize"
    let query = {
      "response_type": "code",
      "client_id": "{{ client_id }}",
      "scope": "openid email profile",
      "redirect_uri": "http://localhost:8000/code",
      "state": state,
      "nonce": nonce,
    }
    let query_str = Object.entries(query).map(([k, v]) => `${k}=${encodeURIComponent(v)}`).join("&")
    console.log("url: ", `${url}?${query_str}`)
    location.href = `${url}?${query_str}`
  })
  
document.addEventListener("DOMContentLoaded", async function() {
  const idinfo = localStorage.getItem("idinfo")
  const token_response = localStorage.getItem("token_response")
  console.log("idinfo:", idinfo)
  console.log("token_response:", token_response)
})
</script>
</body>
</html>